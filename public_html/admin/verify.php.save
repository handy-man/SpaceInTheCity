<?PHP
//Load our database
require("../dbconfig.php");
require("../config.php");
require("../includes/session.php");
//Database connect
$connect = mysqli_connect($host,$user,$pass,$dbname);
//Username & password grab
$myusername=$_POST['u'];
$mypassword=$_POST['p'];
//Username and password mysqli check
$myusername = mysqli_real_escape_string($connect, $myusername);
$mypassword = mysqli_real_escape_string($connect, $mypassword);

$saltgrab = mysqli_query($connect, "SELECT * FROM `users` WHERE `email` = '$myusername' LIMIT 0, 1");	
$saltgrab_array = mysqli_fetch_array($saltgrab);
$salt = $saltgrab_array['salt'];
$mypassword = crypt($mypassword, $salt);

//Mysql stuff
$check = mysqli_query($connect, "SELECT * FROM `users` WHERE `email` = '$myusername' and password = '$mypassword' LIMIT 0, 1");	
$playerarray = mysqli_fetch_array( $check);
$user_displayname = $playerarray['displayname'];
$user_email = $playerarray['email'];
$user_admin_status = $playerarray['admin'];


if ($user_admin_status == 1){
//redirect user to admin backend with the correct session data.
$_SESSION['admin'] = 1;
$_SESSION['email'] = $user_email;
$_SESSION['displayname'] = $user_displayname;
$_SESSION['id'] = $user_ID;
header('Location: ' . $home . '/admin/');
}
else{
//redirect user to admin backend login page with alert about how bad they are.
setcookie("failedlogin", "true", time()+60);
header('Location: ' . $home . '/admin/login.php');
}






 ?>
